<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard IOT</title>
</head>
<body>
    <h2>Monitoramento DHT11</h2>
    <canvas id="grafico" width="400" height="200"></canvas>

    <script>
        const client = mqtt.connect("wss://broker.hivemq.com:8884/mqtt");

const labels = [];
const dataTemp = [];
const dataUmid = [];

const ctx = document.getElementById("grafico").getContext("2d");
const chart = new Chart(ctx, {
    type: "line",
    data: {
        labels: labels,
        datasets: [
            {
                label: "Temperatura (Â°C)",
                data: dataTemp,
                borderColor: "red",
                fill: false
            },
            {
                label: "Umidade (%)",
                data: dataUmid,
                borderColor: "#003cffff",
                fill: false
            }
        ]
    }
});

client.on("connect", () => {
    console.log("Conectado ao broker MQTT");
    client.subscribe("senai/iot/dh11");
});

client.on("message", (topic, message) => {
    const data = JSON.parse(message.toString());
    const time = new Date().toLocaleTimeString();

    labels.push(time);
    tempData.push(data.temperatura);
    umidData.push(data.umidade);

    if (labels.length > 20) {
        labels.shift();
        tempData.shift();
        umidData.shift();
    }

    chart.update();
});
 </script>
</body>
</html>